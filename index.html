<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TRULEGEND: Airdrop Hub</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        :root { --accent: #0088cc; --bg: #0a0a0b; --glass: rgba(255, 255, 255, 0.08); --border: rgba(255,255,255,0.12); --success: #4CAF50; --warning: #ff9800; --gold: #FFD700; --silver: #C0C0C0; --bronze: #CD7F32; }
        body { background: var(--bg); color: white; font-family: 'Inter', sans-serif; margin: 0; overflow: hidden; height: 100vh; }

        /* UI ELEMENTS */
        .header-ui { position: fixed; top: 0; width: 100%; height: 60px; display: flex; justify-content: space-between; align-items: center; padding: 0 15px; box-sizing: border-box; z-index: 1000; background: rgba(0,0,0,0.4); backdrop-filter: blur(10px); }
        #sync-pill { display: flex; align-items: center; gap: 6px; background: rgba(255,255,255,0.05); padding: 6px 12px; border-radius: 20px; font-size: 0.65rem; border: 1px solid var(--border); }
        .dot { width: 6px; height: 6px; background: var(--success); border-radius: 50%; }
        .withdraw-btn { background: #ff9800; color: black; font-size: 0.7rem; font-weight: 800; padding: 7px 15px; border-radius: 10px; border: none; cursor: pointer; }

        .screen { display: none; padding: 20px; height: calc(100vh - 110px); overflow-y: auto; margin-top: 60px; box-sizing: border-box; padding-bottom: 50px; }
        .active-screen { display: block; }
        .card { background: var(--glass); padding: 18px; border-radius: 20px; border: 1px solid var(--border); margin-bottom: 15px; }

        /* MINE TAB */
        .balance { font-size: 3.5rem; font-weight: 900; text-align: center; margin-top: 20px; text-shadow: 0 0 25px var(--accent); }
        .circle-btn { width: 220px; height: 220px; background: radial-gradient(circle at 30% 30%, #0088cc, #001a33); border-radius: 50%; margin: 30px auto; display: flex; align-items: center; justify-content: center; font-size: 6rem; box-shadow: 0 0 50px rgba(0,136,204,0.3); border: 8px solid var(--border); cursor: pointer; user-select: none; transition: transform 0.05s; position: relative; }
        .circle-btn:active { transform: scale(0.92); }

        /* ROADMAP & LISTS */
        .step { border-left: 2px solid var(--border); padding-left: 15px; margin-bottom: 15px; position: relative; }
        .step.active { border-left-color: var(--accent); }
        .stat-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 0.85rem; }
        .ref-item { display: flex; justify-content: space-between; padding: 12px; background: rgba(255,255,255,0.03); border-radius: 12px; margin-bottom: 8px; font-size: 0.8rem; border: 1px solid var(--border); align-items: center; }
        
        /* RANK BADGES */
        .badge { width: 24px; height: 24px; display: inline-flex; align-items: center; justify-content: center; border-radius: 6px; margin-right: 8px; font-weight: bold; font-size: 0.7rem; }
        .rank-1 { background: var(--gold); color: black; box-shadow: 0 0 10px var(--gold); }
        .rank-2 { background: var(--silver); color: black; }
        .rank-3 { background: var(--bronze); color: black; }

        /* TIMER GRID */
        .timer-grid { display: flex; justify-content: space-between; margin-top: 15px; gap: 8px; }
        .t-box { background: rgba(255,255,255,0.05); flex: 1; padding: 10px 5px; border-radius: 12px; text-align: center; border: 1px solid var(--border); }
        .t-num { display: block; font-size: 1.1rem; font-weight: 900; color: var(--accent); }
        .t-lab { font-size: 0.5rem; opacity: 0.5; text-transform: uppercase; letter-spacing: 1px; }

        /* NAV DOCK */
        .dock { position: fixed; bottom: 0; width: 100%; background: #000; display: flex; justify-content: space-around; padding: 12px 0 35px; border-top: 1px solid #333; z-index: 1000; }
        .dock-item { opacity: 0.4; font-size: 0.55rem; text-align: center; color: white; flex: 1; cursor: pointer; }
        .dock-item.active { opacity: 1; color: var(--accent); font-weight: bold; }
    </style>
</head>
<body>

    <div class="header-ui">
        <div id="sync-pill"><div class="dot" id="sync-dot"></div><span id="sync-text">SYNCED ‚úì</span></div>
        <button class="withdraw-btn" onclick="tg.showAlert('Withdrawal opens at TGE.')">WITHDRAW</button>
    </div>

    <div id="tab-mine" class="screen active-screen">
        <div class="balance" id="balance">0</div>
        <div style="text-align: center; opacity: 0.7; margin-bottom: 10px;">‚ö° <span id="energy">1000</span> / 1000</div>
        <div class="circle-btn" id="tap-btn">üíé</div>
    </div>

    <div id="tab-tasks" class="screen">
        <h3>Quests</h3>
        <div id="task-list"></div>
    </div>

    <div id="tab-friends" class="screen">
        <h3>Invite Friends</h3>
        <div class="card" style="text-align:center; border-color: var(--accent);">
            <p style="font-size:0.9rem; margin-bottom:15px;">Get <b>50,000 $TRU</b> per invite!</p>
            <button class="withdraw-btn" style="width:100%; padding:15px;" onclick="shareInvite()">INVITE A FRIEND</button>
        </div>
        <div class="card">
            <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                <b>Your Referrals</b>
                <b style="color:var(--accent)" id="ref-count">0 Users</b>
            </div>
            <div id="ref-list"></div>
        </div>
    </div>

    <div id="tab-drop" class="screen">
        <h3>Airdrop Hub</h3>
        <div class="card" style="border-color:var(--warning)">
            <b style="color:var(--warning)">Allocation Checklist</b>
            <div class="stat-row"><span>Mined Tokens</span><span id="drop-mined">0</span></div>
            <div class="stat-row"><span>Total Referrals</span><span id="drop-refs">0</span></div>
        </div>

        <div class="card">
            <b>TGE Listing Countdown</b>
            <div class="timer-grid">
                <div class="t-box"><span class="t-num" id="days">00</span><span class="t-lab">Days</span></div>
                <div class="t-box"><span class="t-num" id="hours">00</span><span class="t-lab">Hrs</span></div>
                <div class="t-box"><span class="t-num" id="mins">00</span><span class="t-lab">Min</span></div>
                <div class="t-box"><span class="t-num" id="secs">00</span><span class="t-lab">Sec</span></div>
            </div>
        </div>

        <div class="card">
            <b>Project Roadmap</b>
            <div style="margin-top:20px;">
                <div class="step active">
                    <div style="display:flex; justify-content:space-between; align-items:start;">
                        <small style="color:var(--accent); font-weight:bold;">PHASE 1</small>
                        <small style="background:var(--success); color:white; padding:2px 6px; border-radius:4px; font-size:0.5rem;">COMPLETED</small>
                    </div>
                    <div style="font-size:0.85rem; margin-top:4px;"><b>Community Genesis</b><br>Token mining launch and global referral system.</div>
                </div>
                <div class="step active" style="border-left-style: dashed;">
                    <div style="display:flex; justify-content:space-between; align-items:start;">
                        <small style="color:var(--accent); font-weight:bold;">PHASE 2</small>
                        <small style="background:var(--warning); color:black; padding:2px 6px; border-radius:4px; font-size:0.5rem;">IN PROGRESS</small>
                    </div>
                    <div style="font-size:0.85rem; margin-top:4px;"><b>Ecosystem Growth</b><br>Wallet connection, on-chain tasks, and verification.</div>
                </div>
                <div class="step">
                    <div style="display:flex; justify-content:space-between; align-items:start;">
                        <small style="opacity:0.5; font-weight:bold;">PHASE 3</small>
                        <small style="background:rgba(255,255,255,0.1); color:white; padding:2px 6px; border-radius:4px; font-size:0.5rem;">LOCKED</small>
                    </div>
                    <div style="font-size:0.85rem; margin-top:4px; opacity:0.6;"><b>The Grand TGE</b><br>Final snapshot, exchange listing, and token distribution.</div>
                </div>
            </div>
        </div>
        <button style="background:var(--accent); color:white; border:none; width:100%; padding:18px; border-radius:15px; font-weight:bold; margin-bottom:20px;" onclick="tg.showAlert('Wallet connection opens in Phase 2!')">CONNECT WALLET</button>
    </div>

    <div id="tab-rank" class="screen">
        <h3>Global Ranking</h3>
        <div class="card" id="leader-list">
            <p style="text-align:center; opacity:0.5; padding:20px;">Ranking legends...</p>
        </div>
    </div>

    <div class="dock">
        <div class="dock-item active" onclick="switchTab('mine', this)">‚õèÔ∏è<br>MINE</div>
        <div class="dock-item" onclick="switchTab('tasks', this)">üìã<br>TASKS</div>
        <div class="dock-item" onclick="switchTab('friends', this)">üë•<br>FRIENDS</div>
        <div class="dock-item" onclick="switchTab('drop', this)">üí∞<br>DROP</div>
        <div class="dock-item" onclick="switchTab('rank', this)">üèÜ<br>RANK</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const config = {
            apiKey: "AIzaSyC2O8gD1lWx9QFS4FBZCrECjJ-icafg6ds",
            authDomain: "trulegend-be32e.firebaseapp.com",
            databaseURL: "https://trulegend-be32e-default-rtdb.firebaseio.com",
            projectId: "trulegend-be32e",
            storageBucket: "trulegend-be32e.firebasestorage.app",
            messagingSenderId: "462505787354",
            appId: "1:462505787354:web:60a34512cef1f26ef34ae3"
        };
        firebase.initializeApp(config);
        const db = firebase.database();

        let state = { id: tg.initDataUnsafe?.user?.id || "dev_user", balance: 0, energy: 1000, tasks: {}, referredUsers: [] };

        const taskList = [
            { id: 'tg_join', title: 'Join Official Channel', reward: 50000, url: 'https://t.me/yourlink' },
            { id: 'x_follow', title: 'Follow on X', reward: 20000, url: 'https://x.com/yourlink' }
        ];

        function init() {
            db.ref('users/' + state.id).on('value', (s) => {
                if(s.exists()) state = {...state, ...s.val()};
                updateUI(); renderTasks(); renderFriends(); loadLeaderboard();
            });
            startTimer();
        }

        function startTimer() {
            const target = new Date("December 31, 2026 00:00:00").getTime();
            setInterval(() => {
                const now = new Date().getTime();
                const d = target - now;
                const f = (n) => n.toString().padStart(2, '0');
                if(d < 0) return;
                document.getElementById('days').innerText = f(Math.floor(d / (1000 * 60 * 60 * 24)));
                document.getElementById('hours').innerText = f(Math.floor((d % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)));
                document.getElementById('mins').innerText = f(Math.floor((d % (1000 * 60 * 60)) / (1000 * 60)));
                document.getElementById('secs').innerText = f(Math.floor((d % (1000 * 60)) / 1000));
            }, 1000);
        }

        function save() { db.ref('users/' + state.id).update(state); }

        function shareInvite() {
            const link = `https://t.me/TruLegendBot?start=${state.id}`;
            tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(link)}&text=üíé Mine $TRU with me!`);
        }

        function loadLeaderboard() {
            db.ref('users').orderByChild('balance').limitToLast(10).on('value', (snap) => {
                let users = []; snap.forEach(c => { users.push(c.val()); });
                users.sort((a,b) => b.balance - a.balance);
                document.getElementById('leader-list').innerHTML = users.map((u, i) => {
                    let badgeClass = i==0?'rank-1':i==1?'rank-2':i==2?'rank-3':'';
                    let icon = i==0?'ü•á':i==1?'ü•à':i==2?'ü•â':`#${i+1}`;
                    return `<div class="ref-item" style="${u.id == state.id ? 'border-color:var(--accent); background:rgba(0,136,204,0.1)' : ''}">
                        <span><span class="badge ${badgeClass}">${icon}</span> User_${u.id.toString().slice(-4)}</span>
                        <b>${Math.floor(u.balance).toLocaleString()}</b>
                    </div>`;
                }).join('');
            });
        }

        function renderTasks() {
            const container = document.getElementById('task-list');
            container.innerHTML = taskList.map(t => {
                const done = (state.tasks || {})[t.id];
                return `<div class="card" style="display:flex; justify-content:space-between; align-items:center; ${done ? 'opacity:0.5' : ''}">
                    <div><b>${t.title}</b><br><small>+${t.reward.toLocaleString()}</small></div>
                    <button class="withdraw-btn" style="background:${done ? '#444' : 'var(--accent)'}" onclick="doTask('${t.id}', '${t.url}', ${t.reward})">${done ? 'DONE' : 'GO'}</button>
                </div>`;
            }).join('');
        }

        function doTask(id, url, reward) {
            if((state.tasks || {})[id]) return;
            tg.openLink(url);
            state.balance += reward; if(!state.tasks) state.tasks = {}; state.tasks[id] = true; save();
        }

        document.getElementById('tap-btn').addEventListener('pointerdown', () => {
            if(state.energy >= 1) { state.balance += 1; state.energy -= 1; updateUI(); if(navigator.vibrate) navigator.vibrate(10); }
        });

        function updateUI() {
            document.getElementById('balance').innerText = Math.floor(state.balance).toLocaleString();
            document.getElementById('energy').innerText = state.energy;
            document.getElementById('drop-mined').innerText = Math.floor(state.balance).toLocaleString();
            document.getElementById('drop-refs').innerText = (state.referredUsers || []).length;
        }

        function renderFriends() {
            const friends = state.referredUsers || [];
            document.getElementById('ref-count').innerText = `${friends.length} Users`;
            document.getElementById('ref-list').innerHTML = friends.length ? friends.map(f => `<div class="ref-item"><span>üë§ User_${f.toString().slice(-4)}</span><span style="color:var(--success)">+50k</span></div>`).join('') : '<p style="text-align:center; opacity:0.4; font-size:0.75rem; padding:20px;">Invite friends to see them here.</p>';
        }

        function switchTab(t, el) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active-screen'));
            document.getElementById('tab-' + t).classList.add('active-screen');
            document.querySelectorAll('.dock-item').forEach(d => d.classList.remove('active'));
            el.classList.add('active');
        }

        setInterval(() => { if(state.energy < 1000) { state.energy += 5; updateUI(); save(); } }, 5000);
        init();
    </script>
</body>
</html>