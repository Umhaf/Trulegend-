<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TRULEGEND: Airdrop Hub</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        :root { --accent: #0088cc; --bg: #0a0a0b; --glass: rgba(255, 255, 255, 0.08); --border: rgba(255,255,255,0.12); --success: #4CAF50; --warning: #ff9800; }
        body { background: var(--bg); color: white; font-family: 'Inter', sans-serif; margin: 0; overflow: hidden; height: 100vh; }

        /* HEADER UI */
        .header-ui { position: fixed; top: 0; width: 100%; height: 60px; display: flex; justify-content: space-between; align-items: center; padding: 0 15px; box-sizing: border-box; z-index: 1000; background: rgba(0,0,0,0.4); backdrop-filter: blur(10px); }
        #sync-pill { display: flex; align-items: center; gap: 6px; background: rgba(255,255,255,0.05); padding: 6px 12px; border-radius: 20px; font-size: 0.65rem; border: 1px solid var(--border); }
        .dot { width: 6px; height: 6px; background: var(--success); border-radius: 50%; }
        .withdraw-btn { background: #ff9800; color: black; font-size: 0.7rem; font-weight: 800; padding: 7px 15px; border-radius: 10px; border: none; cursor: pointer; }

        /* SCREENS */
        .screen { display: none; padding: 20px; height: calc(100vh - 110px); overflow-y: auto; margin-top: 60px; box-sizing: border-box; }
        .active-screen { display: block; }
        .card { background: var(--glass); padding: 18px; border-radius: 20px; border: 1px solid var(--border); margin-bottom: 15px; }

        /* MINE */
        .balance { font-size: 3.5rem; font-weight: 900; text-align: center; margin-top: 20px; text-shadow: 0 0 25px var(--accent); }
        .circle-btn { width: 220px; height: 220px; background: radial-gradient(circle at 30% 30%, #0088cc, #001a33); border-radius: 50%; margin: 30px auto; display: flex; align-items: center; justify-content: center; font-size: 6rem; box-shadow: 0 0 50px rgba(0,136,204,0.3); border: 8px solid var(--border); cursor: pointer; user-select: none; transition: transform 0.05s; }
        .circle-btn:active { transform: scale(0.92); }

        /* LISTS */
        .stat-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 0.85rem; }
        .task-done { opacity: 0.5; filter: grayscale(1); }

        /* NAV */
        .dock { position: fixed; bottom: 0; width: 100%; background: #000; display: flex; justify-content: space-around; padding: 12px 0 35px; border-top: 1px solid #333; z-index: 1000; }
        .dock-item { opacity: 0.4; font-size: 0.6rem; text-align: center; color: white; flex: 1; cursor: pointer; }
        .dock-item.active { opacity: 1; color: var(--accent); font-weight: bold; }
    </style>
</head>
<body>

    <div class="header-ui">
        <div id="sync-pill"><div class="dot" id="sync-dot"></div><span id="sync-text">SYNCED ‚úì</span></div>
        <button class="withdraw-btn" onclick="tg.showAlert('Withdrawals open Q3 2026 after Listing.')">WITHDRAW</button>
    </div>

    <div id="tab-mine" class="screen active-screen">
        <div class="balance" id="balance">0</div>
        <div style="text-align: center; opacity: 0.7; margin-bottom: 10px;">‚ö° <span id="energy">1000</span> / 1000</div>
        <div class="circle-btn" id="tap-btn">üíé</div>
    </div>

    <div id="tab-tasks" class="screen">
        <h3>Quests</h3>
        <div id="task-list"></div>
    </div>

    <div id="tab-skins" class="screen">
        <h3>Skins Shop</h3>
        <div id="skin-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;"></div>
    </div>

    <div id="tab-drop" class="screen">
        <h3>Tokenomics & Drop</h3>
        <div class="card" style="text-align:center; border-color:var(--warning)">
            <small style="color:var(--warning)">LISTING IN</small>
            <div id="timer" style="font-size:1.6rem; font-weight:bold; margin:10px 0; font-family:monospace;">00:00:00:00</div>
        </div>
        <div class="card">
            <b>Project Details</b>
            <div class="stat-row"><span>Token Name</span><span>TruLegend</span></div>
            <div class="stat-row"><span>Symbol</span><span style="color:var(--accent)">$TRU</span></div>
            <div class="stat-row"><span>Total Supply</span><span>1,000,000,000</span></div>
            <div class="stat-row"><span>Network</span><span>TON Blockchain</span></div>
        </div>
        <div class="card">
            <b>Distribution</b>
            <div class="stat-row"><span>Airdrop Rewards</span><span style="color:var(--success)">75%</span></div>
            <div class="stat-row"><span>Liquidity</span><span>15%</span></div>
            <div class="stat-row"><span>Team Locked</span><span>10%</span></div>
        </div>
        <button style="background:var(--accent); color:white; border:none; width:100%; padding:15px; border-radius:15px; font-weight:bold;" onclick="tg.showAlert('TON Connect opens Q2 2026')">CONNECT TON WALLET</button>
    </div>

    <div class="dock">
        <div class="dock-item active" onclick="switchTab('mine', this)">‚õèÔ∏è<br>MINE</div>
        <div class="dock-item" onclick="switchTab('tasks', this)">üìã<br>TASKS</div>
        <div class="dock-item" onclick="switchTab('skins', this)">üé®<br>SKINS</div>
        <div class="dock-item" onclick="switchTab('drop', this)">üí∞<br>DROP</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const config = {
            apiKey: "AIzaSyC2O8gD1lWx9QFS4FBZCrECjJ-icafg6ds",
            authDomain: "trulegend-be32e.firebaseapp.com",
            databaseURL: "https://trulegend-be32e-default-rtdb.firebaseio.com",
            projectId: "trulegend-be32e",
            storageBucket: "trulegend-be32e.firebasestorage.app",
            messagingSenderId: "462505787354",
            appId: "1:462505787354:web:60a34512cef1f26ef34ae3"
        };
        firebase.initializeApp(config);
        const db = firebase.database();

        let state = {
            id: tg.initDataUnsafe?.user?.id || "dev_user",
            balance: 0, energy: 1000, equippedSkin: 'üíé', ownedSkins: ['üíé'], tasks: {}
        };

        const skins = [
            { icon: 'üíé', name: 'Original', price: 0 },
            { icon: 'üìÄ', name: 'Silver', price: 10000 },
            { icon: 'üü°', name: 'Gold', price: 50000 },
            { icon: 'üî•', name: 'Inferno', price: 250000 }
        ];

        const availableTasks = [
            { id: 'tg_join', title: 'Join TruLegend Channel', reward: 50000, url: 'https://t.me/yourlink' },
            { id: 'x_follow', title: 'Follow on X', reward: 20000, url: 'https://x.com/yourlink' }
        ];

        function init() {
            db.ref('users/' + state.id).once('value', (s) => {
                if(s.exists()) state = {...state, ...s.val()};
                if(!state.tasks) state.tasks = {};
                updateUI();
                renderSkins();
                renderTasks();
                startCountdown();
            });
        }

        function save() {
            const status = document.getElementById('sync-text');
            const dot = document.getElementById('sync-dot');
            status.innerText = "SAVING...";
            dot.style.background = "var(--warning)";
            db.ref('users/' + state.id).update(state).then(() => {
                setTimeout(() => {
                    status.innerText = "SYNCED ‚úì";
                    dot.style.background = "var(--success)";
                }, 800);
            });
        }

        function renderTasks() {
            const list = document.getElementById('task-list');
            list.innerHTML = '';
            availableTasks.forEach(t => {
                const done = state.tasks[t.id];
                list.innerHTML += `
                    <div class="card ${done ? 'task-done' : ''}" style="display:flex; justify-content:space-between; align-items:center;">
                        <div><b>${t.title}</b><br><small style="color:var(--success)">+${t.reward/1000}k $TRU</small></div>
                        <button class="withdraw-btn" style="background:${done ? '#444' : 'var(--accent)'}" 
                        onclick="doTask('${t.id}', '${t.url}', ${t.reward})">${done ? 'CLAIMED' : 'GO'}</button>
                    </div>`;
            });
        }

        function doTask(id, url, reward) {
            if(state.tasks[id]) return;
            tg.openLink(url);
            state.balance += reward;
            state.tasks[id] = true;
            save(); updateUI(); renderTasks();
        }

        function renderSkins() {
            const grid = document.getElementById('skin-grid');
            grid.innerHTML = '';
            skins.forEach(s => {
                const owned = (state.ownedSkins || ['üíé']).includes(s.icon);
                const active = state.equippedSkin === s.icon;
                grid.innerHTML += `
                    <div class="card" style="text-align:center; padding:10px; ${active ? 'border-color:var(--accent)' : ''}">
                        <div style="font-size:2.5rem">${s.icon}</div>
                        <button class="withdraw-btn" style="width:100%; margin-top:10px; background:${active ? 'var(--success)' : (owned ? '#555' : 'var(--accent)')}" 
                        onclick="${owned ? `setSkin('${s.icon}')` : `buySkin('${s.icon}', ${s.price})`}">
                        ${active ? 'ACTIVE' : (owned ? 'USE' : s.price/1000+'k')}</button>
                    </div>`;
            });
        }

        function setSkin(icon) { state.equippedSkin = icon; save(); renderSkins(); updateUI(); }
        function buySkin(icon, price) {
            if(state.balance >= price) { state.balance -= price; state.ownedSkins.push(icon); save(); renderSkins(); updateUI(); }
        }

        document.getElementById('tap-btn').addEventListener('pointerdown', () => {
            if(state.energy >= 1) {
                state.balance += 1;
                state.energy -= 1;
                updateUI();
                if(navigator.vibrate) navigator.vibrate(10);
            }
        });

        function updateUI() {
            document.getElementById('balance').innerText = Math.floor(state.balance).toLocaleString();
            document.getElementById('energy').innerText = state.energy;
            document.getElementById('tap-btn').innerText = state.equippedSkin;
        }

        function startCountdown() {
            const target = new Date("2026-07-01T00:00:00").getTime();
            setInterval(() => {
                const now = new Date().getTime();
                const d = target - now;
                const days = Math.floor(d / (1000 * 60 * 60 * 24));
                const hours = Math.floor((d % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const mins = Math.floor((d % (1000 * 60 * 60)) / (1000 * 60));
                const secs = Math.floor((d % (1000 * 60)) / 1000);
                document.getElementById('timer').innerText = `${days}d ${hours}h ${mins}m ${secs}s`;
            }, 1000);
        }

        function switchTab(t, el) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active-screen'));
            document.getElementById('tab-' + t).classList.add('active-screen');
            document.querySelectorAll('.dock-item').forEach(d => d.classList.remove('active'));
            el.classList.add('active');
        }

        setInterval(() => { if(state.energy < 1000) state.energy += 5; save(); updateUI(); }, 5000);
        init();
    </script>
</body>
</html>